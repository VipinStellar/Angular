<style>
table.count_table {
  counter-reset: section;
}
table.count_table th{
  font-weight: 500;
}

table.count_table tbody tr td.inc-td:after {
  counter-increment: section;
  content: counter(section) "";
}
table thead tr.table-title{ 
  background-color: #f2f2f2 !important;
}
::ng-deep table tr{ 
  background-color: #ffffff !important;
}
</style>
<div class="content-wrapper">
    <div class="content-header" style="margin-top: 57px;">
      <div class="container-fluid">
        <app-tab [mediaDetails]="mediaDetails" ></app-tab>
      </div>
    </div>
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12" [innerHtml]="mediaDetails|mediaTable">          
          </div>
          <div class="col-12">
            <table class="table table-striped table-bordered responsive count_table">
              <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">Status Update</th>
                  <th >
                    <span style="float:right">
                    <a  href="javascript:void(0)" (click)="statusUpdate()" *ngIf="showStatusButton && user.role_id == 10 && user.id == mediaDetails['ise_user_id']" class="btn btn-primary btn-sm " >Status Update</a>
                    <a  href="javascript:void(0)" (click)="notifyTech()" *ngIf="user.role_id == 10 && user.id == mediaDetails['ise_user_id']" class="btn btn-primary btn-sm ml-2" >Notify Technician</a>
                  </span>
                  </th>
              </tr>
              
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
             </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
                <tbody>
                <tr *ngIf="item['module_type'] == 'STATUS-UPDATE' || item['module_type'] == 'NOTIFY-TECH'">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :
                    item['user_name'] }}</td>
                  <td [innerHtml]="item['remarks']"></td>
                </tr>
              </tbody>
              </ng-container>
            </table>
          </div>
          <div class="col-12">
            <table class="table table-striped table-bordered responsive count_table">
              <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">Pre Inspection</th>
                <th>
                  <a style="float:right" [routerLink]="['../../pre-inspection', mediaDetails['id']]" class="btn btn-primary btn-sm" *ngIf="editButton('Pre-Inspection',mediaDetails['user_id'],mediaDetails['stage'])">
                    Edit Details</a>
                  </th>
              </tr>
              
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
             </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
                <tbody>
                <tr *ngIf="item['module_type'] == 'PRE-ANALYSIS'">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :
                    item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
              </tbody>
              </ng-container>
            </table>
          </div>
          <div class="col-12" *ngIf="mediaDetails['job_id'] != null">
            <table class="table table-striped table-bordered responsive count_table">
              <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">Media Inspection</th>
                <th>
                  <a style="float:right" [routerLink]="['../../inspection', mediaDetails['id']]" class="btn btn-primary btn-sm"
                    *ngIf="editButton('Inspection',mediaDetails['user_id'],mediaDetails['stage'])">
                    Edit Details</a>
                </th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
             </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
                <tbody>
                 <tr mdbTableCol *ngIf="item['module_type'] == 'INSPECTION';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
              </tbody>
              </ng-container>
            </table>
          </div>
          
          <div class="col-12" *ngIf="mediaDetails['job_id'] != null">
            <table class="table table-striped table-bordered responsive count_table" >
              <thead>
              <tr class="table-title">
                <th colspan="4" class="h6">Details of Time Extension Request</th>
                <th>
                  <a style="float:right" href="javascript:void(0)" (click)="editExtension('EXTENSION-DAY')" class="btn btn-primary btn-sm" *ngIf="extensionButton(mediaDetails['user_id'],mediaDetails['stage']) && mediaDetails['extension_approve'] !='1'">Edit Details</a>
                  <a style="float:right" href="javascript:void(0)" (click)="updateExtension('EXTENSION-DAY')" class="btn btn-primary btn-sm" *ngIf="user.role_id == 10 && user.id == mediaDetails['ise_user_id'] && mediaDetails['extension_approve'] =='1'">Edit Details</a>
                </th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th width="100">Status</th>
                <th>Reason</th>
              </tr>
              </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
              <tbody>
                <tr mdbTableCol *ngIf="item['module_type'] == 'EXTENSION-DAY';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['ext_status']}} </td>
                  <td [innerHtml]="item['remarks']"></td>
                </tr>
              </tbody>
              </ng-container>
            </table>
          </div>
          <div class="col-12" *ngIf="recListShow && mediaDetails['media_type'] !='Flash Media'">
            <table class="table table-striped table-bordered responsive count_table">
              <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">{{(mediaDetails['media_type'] =='Hard Drive' || mediaDetails['media_type'] =='External Hard Drive')?'Initial Observation':'Recovery Process'}}</th>
                <th><a style="float:right"  [routerLink]="['../../observation', mediaDetails['id']]"  class="btn btn-primary btn-sm" *ngIf="editButton('Recovery',mediaDetails['user_id'],mediaDetails['stage'])">Edit Details</a></th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
            </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
              <tbody>
                <tr mdbTableCol *ngIf="item['module_type'] == 'OBSERVATION';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
              </tbody>
              </ng-container>
            </table>
          </div>
          <div class="col-12" *ngIf="recListShow">
            <table class="table table-striped table-bordered responsive count_table" >
              <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">Clone Creation</th>
                <th><a style="float:right" href="javascript:void(0)" (click)="editRecovery('CLONECREATION')" class="btn btn-primary btn-sm" *ngIf="editButton('Recovery',mediaDetails['user_id'],mediaDetails['stage'])">Edit Details</a></th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
              </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
              <tbody>
                <tr mdbTableCol *ngIf="item['module_type'] == 'CLONECREATION';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
              </tbody>
              </ng-container>
            </table>
          </div>
          <div class="col-12" *ngIf="recListShow">
            <table class="table table-striped table-bordered responsive count_table" >
              <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">Data Encrypted</th>
                <th><a style="float:right" href="javascript:void(0)" (click)="editRecovery('DATA-ENCRYPTED')" class="btn btn-primary btn-sm" *ngIf="editButton('Recovery',mediaDetails['user_id'],mediaDetails['stage'])">Edit Details</a></th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
            </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
              <tbody>
                <tr mdbTableCol *ngIf="item['module_type'] == 'DATA-ENCRYPTED';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
              </tbody>
              </ng-container>
            </table>
          </div>
          <div class="col-12" *ngIf="recListShow">
            <table class="table table-striped table-bordered responsive count_table" >
            <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">Client Data Recoverable</th>
                <th><a style="float:right" href="javascript:void(0)" (click)="editRecovery('RECOVERABLE-DATA')" class="btn btn-primary btn-sm" *ngIf="editButton('Recovery',mediaDetails['user_id'],mediaDetails['stage'])">Edit Details</a></th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
            </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
                <tbody>
                <tr mdbTableCol *ngIf="item['module_type'] == 'RECOVERABLE-DATA';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
              </tbody>
              </ng-container>
            </table> 
          </div>
         
          <div class="col-12" *ngIf="mediaDetails['rec_recoverable_data']=='Yes' && mediaDetails['rec_clone_branch'] !=null">
            <table class="table table-striped table-bordered responsive count_table" >
              <thead>
              <tr class="table-title">
                <th colspan="3" class="h6">Directory Listing Details</th>
                <th><a style="float:right" href="javascript:void(0)" (click)="editDirectory()" class="btn btn-primary btn-sm" *ngIf="user.id == mediaDetails['user_id']  &&  (mediaDetails['Directory_Listing'] ==null || mediaDetails['stage'] == 22)">Edit Details</a></th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
            </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
                <tbody>
                <tr mdbTableCol *ngIf="item['module_type'] == 'DIRECTORY-LISTING';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
               </tbody>
              </ng-container>
            </table>
          </div>

          <div class="col-12" *ngIf="mediaDetails['Directory_Listing'] !=null">
            <table class="table table-striped table-bordered responsive count_table" >
              <thead>
              <tr class="table-title">
                <th  colspan="4" class="h6">Directory Listing Confirmation
                <a style="float:right;" *ngIf="((user.role_id == 10 && user.id == mediaDetails['ise_user_id']) && (mediaDetails['stage']==22 || mediaDetails['Directory_Listing']['data_varification'] ==null))" href="javascript:void(0)"  class="btn btn-primary btn-sm"
                (click)="clientDataSatisfy()">Edit Details</a>
                <a style="float:right; margin-right: 1px;"  href="javascript:void(0)"   class="btn btn-primary btn-sm" (click)="ViewDlDetails()">Preview</a>
                <a style="float:right" href="javascript:void(0)" (click)="reworkEdit()" class="btn btn-primary btn-sm" *ngIf="mediaDetails['Directory_Listing']['dl_status'] == 'No' && mediaDetails['Directory_Listing']['rework']=='Yes' && user.id == mediaDetails['user_id'] && mediaDetails['Directory_Listing']['rework_possible'] ==null ">Rework Edit</a>
              </th>
              </tr>
              <tr>
                <th width="30">S.No</th>
                <th width="200">Modified On</th>
                <th width="200">Modified By</th>
                <th>Remarks</th>
              </tr>
            </thead>
            <ng-container *ngFor="let item of _history; let i = index" >
              <tbody>
              <tr mdbTableCol *ngIf="item['module_type'] == 'DIRECTORY-CONFIRM';">
                <td class="inc-td"></td>
                <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                <td>{{item['remarks']}}</td>
              </tr>
             </tbody>
            </ng-container>
            </table>
            <table class="table table-striped table-bordered responsive count_table">
              <thead>
                <tr class="table-title">
                  <th  colspan="4" class="h6">Data Out    
                    <a style="float:right" href="javascript:void(0)" (click)="dataOutRequest(mediaDetails['Directory_Listing'],'Tech')" class="btn btn-primary btn-sm" *ngIf="mediaDetails['stage']==12 && mediaDetails['Directory_Listing']['dl_status']== 'Yes' && user.id == mediaDetails['user_id'] && mediaDetails['Directory_Listing']['data_copy_status'] != 'Yes'">Data out</a>        
                    <a style="float:right" href="javascript:void(0)" (click)="dataOutRequest(mediaDetails['Directory_Listing'],'ISE')" class="btn btn-primary btn-sm" *ngIf="mediaDetails['stage']==12 && mediaDetails['Directory_Listing']['dl_status'] == 'Yes' && user.id == mediaDetails['ise_user_id'] && mediaDetails['Directory_Listing']['data_out_mode'] ==null && mediaDetails['Directory_Listing']['data_copy_status'] == 'Yes' && (mediaDetails['balance_amount'] == 0 || mediaDetails['balance_amount'] ==null)">Data out</a>        
                    <a style="float:right" href="javascript:void(0)" class="btn btn-danger btn-sm" *ngIf="mediaDetails['stage']==12 && mediaDetails['Directory_Listing']['dl_status'] == 'Yes' && user.id == mediaDetails['ise_user_id'] && mediaDetails['Directory_Listing']['data_out_mode'] ==null && mediaDetails['Directory_Listing']['data_copy_status'] == 'Yes' && (mediaDetails['balance_amount'] != 0)">Please collect full recovery fee for Data Out</a>        
                </th>
                </tr>
                <tr>
                  <th width="30">S.No</th>
                  <th width="200">Modified On</th>
                  <th width="200">Modified By</th>
                  <th>Remarks</th>
                </tr>
              </thead>
              <ng-container *ngFor="let item of _history; let i = index" >
                <tbody>
                <tr mdbTableCol *ngIf="item['module_type'] == 'DATA-OUT';">
                  <td class="inc-td"></td>
                  <td>{{item['added_on'] | date:'MMM dd, yyyy  hh:mm a'}}</td>
                  <td>{{item['user_name'] ==null ? item['added_by'] :item['user_name'] }}</td>
                  <td>{{item['remarks']}}</td>
                </tr>
               </tbody>
              </ng-container>
            </table>           
          </div>
          <div class="col-12">
            <table class="table table-striped table-bordered responsive " >
              <thead>
              <tr class="table-title">
                <th  colspan="7" class="h6">Media Out
                  <a style="float:right" class="pl-3" href="javascript:void(0)" *ngIf="editButton('MEDIAOUT',mediaDetails['ise_user_id'],mediaDetails['stage'])" (click)="mediaOutRequest()">Request for Media Out</a>
                  <a style="float:right" href="javascript:void(0)" *ngIf="editButton('MEDIAOUT',mediaDetails['ise_user_id'],mediaDetails['stage']) && (mediaDetails['balance_amount'] == 0 || mediaDetails['balance_amount'] ==null)" (click)="mediaOutForClient()">Media Out for Client</a>
                </th>
              </tr>
              <tr>
                <th>S.No.</th>
                <th>Request Type</th>
                <th>Requested By</th>
                <th>Requested To</th>
                <th>Date</th>
                <th>Remarks</th>
                <th>Status</th>
              </tr>
                  <tr *ngFor="let item of mediaDetails['mediaout']; let i = index" >
                  <td>{{i+1}}</td>
                  <td>{{item['request_type']}}</td>
                  <td>{{item['resBy']}}</td>
                  <td>{{item['resTo']}}</td>
                  <td>{{item['request_date'] | date}}</td>
                  <td>{{item['remarks']}}</td>
                  <td>{{(item['status_type'] == '0')?'Pending':(item['status_type'] == '1')?'Approve':'Media Out'}}
                    <br><a href="javascript:void(0)" *ngIf="item['status_type'] == '0' && user.id == item['user_id_to'] && user.team_id != 10" (click)="mediaOutResponce(item)">Send Media to Front Desk</a>
                  </td>
                </tr>
            </thead>
            </table>
          </div>
          <div class="col-12">
            <table class="table table-striped table-bordered responsive " >
              <thead>
              <tr class="table-title">
                <th  colspan="6" class="h6">Wiping
                  <!-- <a style="float:right" (click)="wipingRequest()" href="javascript:void(0)" *ngIf="mediaDetails['branch_id'] == user.branch_id && mediaDetails['transfer_id'] !=null && mediaDetails['wiping_request'] ==null">Request for Wiping To Another Branch</a> -->
                </th>
              </tr>
              <tr>
                <th>S.No.</th>
                <th>Request Wiping Date</th>
                <th>Expected Wiping Date</th>
                <th>Assigned</th>
                <th>Wiping Date</th>
                <th>Status</th>
              </tr>
                  <tr *ngFor="let item of mediaDetails['wiping']; let i = index" >
                  <td>{{i+1}}</td>
                  <td>{{item['request_wiping_date'] | date}}</td>
                  <td>{{item['expected_wiping_date'] | date}}</td>
                  <td>{{item['username']}}</td>
                  <td>{{item['approve_wiping_date'] | date}}</td>
                  <td>{{(item['status'] == '0')?'Pending':"Done"}}</td>
                </tr>
            </thead>
            </table>
          </div>
        </div>
  
      </div>
    </section>
  </div>